<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Medusa Media Server</title>
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" />
    <link rel="stylesheet" href="{{ url_for('static', filename='css/main.css') }}" />
</head>
<body>
    <div class="app-shell">
        <aside class="sidebar">
            <div class="logo">
                <span class="logo-icon">üúÅ</span>
                <div>
                    <h1>Medusa</h1>
                    <p class="subtitle">Media Server</p>
                </div>
            </div>
            <nav class="menu">
                <a href="#" class="menu-item active" data-target="start">Startseite</a>
                <a href="#" class="menu-item" data-target="filme">Filme</a>
                <a href="#" class="menu-item" data-target="serien">Serien</a>
                <a href="#" class="menu-item" data-target="scraper">Scraper</a>
                <a href="#" class="menu-item" data-target="settings">Einstellungen</a>
            </nav>
            <div class="sidebar-footer">
                <button id="syncTmdb" class="btn btn-primary">TMDB aktualisieren</button>
                <button id="scrapeKinox" class="btn btn-secondary">Kinox scrapen</button>
            </div>
        </aside>
        <main class="content">
            <section class="panel active" data-section="start">
                <header class="hero" id="hero">
                    <div class="hero-content">
                        <h2>Entdecke deine Mediathek</h2>
                        <p>Medusa kombiniert die Eleganz von Plex mit der Dynamik von Netflix. Synchronisiere Inhalte von TMDB und erweitere deine Sammlung mit externen Quellen.</p>
                        <div class="hero-actions">
                            <button class="btn btn-primary" id="refreshHero">Zuf√§lliger Film</button>
                            <button class="btn btn-secondary" data-target="filme">Zu den Filmen</button>
                        </div>
                    </div>
                </header>
                {% for name, movies in categories.items() %}
                <section class="carousel">
                    <div class="section-header">
                        <h3>{{ name }}</h3>
                        <span class="section-hint">Handverlesene Highlights</span>
                    </div>
                    {% if movies %}
                    <div class="carousel-track">
                        {% for movie in movies %}
                        {% set poster_url = movie.poster_path and "https://image.tmdb.org/t/p/w500" + movie.poster_path or url_for('static', filename='images/poster-placeholder.svg') %}
                        {% set backdrop_url = movie.backdrop_path and "https://image.tmdb.org/t/p/w780" + movie.backdrop_path or '' %}
                        <article class="card" role="button" tabindex="0"
                                 data-movie-id="{{ movie.id }}"
                                 data-title="{{ movie.title }}"
                                 data-overview="{{ movie.overview|default('')|e }}"
                                 data-backdrop="{{ backdrop_url }}"
                                 data-poster="{{ poster_url }}"
                                 data-release="{{ movie.release_date or '' }}">
                            <div class="card-poster" style="background-image: url('{{ poster_url }}');"></div>
                            <div class="card-overlay">
                                <h4>{{ movie.title }}</h4>
                                <p>{{ movie.release_date or 'Unbekannt' }}</p>
                                <span class="rating">‚≠ê {{ (movie.rating or 0)|round(1) }}</span>
                            </div>
                        </article>
                        {% endfor %}
                    </div>
                    {% else %}
                    <p class="empty">Noch keine Inhalte in dieser Kategorie.</p>
                    {% endif %}
                </section>
                {% endfor %}
            </section>

            <section class="panel" data-section="filme">
                <div class="panel-header">
                    <div>
                        <h2>Filme</h2>
                        <p class="panel-subtitle">Alle Filme deiner Bibliothek, √ºbersichtlich strukturiert wie bei Netflix.</p>
                    </div>
                </div>
                {% if film_sections %}
                    {% for section in film_sections %}
                    <section class="carousel">
                        <div class="section-header">
                            <h3>{{ section.title }}</h3>
                            <span class="section-hint">Film√ºbersicht</span>
                        </div>
                        {% if section["items"] %}
                        <div class="carousel-track">
                            {% for movie in section["items"] %}
                            {% set poster_url = movie.poster_path and "https://image.tmdb.org/t/p/w500" + movie.poster_path or url_for('static', filename='images/poster-placeholder.svg') %}
                            {% set backdrop_url = movie.backdrop_path and "https://image.tmdb.org/t/p/w780" + movie.backdrop_path or '' %}
                            <article class="card" role="button" tabindex="0"
                                     data-movie-id="{{ movie.id }}"
                                     data-title="{{ movie.title }}"
                                     data-overview="{{ movie.overview|default('')|e }}"
                                     data-backdrop="{{ backdrop_url }}"
                                     data-poster="{{ poster_url }}"
                                     data-release="{{ movie.release_date or '' }}">
                                <div class="card-poster" style="background-image: url('{{ poster_url }}');"></div>
                                <div class="card-overlay">
                                    <h4>{{ movie.title }}</h4>
                                    <p>{{ movie.release_date or 'Unbekannt' }}</p>
                                    <span class="rating">‚≠ê {{ (movie.rating or 0)|round(1) }}</span>
                                </div>
                            </article>
                            {% endfor %}
                        </div>
                        {% else %}
                        <p class="empty">In diesem Bereich wurden noch keine Filme gefunden.</p>
                        {% endif %}
                    </section>
                    {% endfor %}
                {% else %}
                    <p class="empty large">Noch keine Filme vorhanden. Synchronisiere zuerst Inhalte.</p>
                {% endif %}
            </section>

            <section class="panel" data-section="serien">
                <div class="panel-header">
                    <div>
                        <h2>Serien</h2>
                        <p class="panel-subtitle">Serien werden hier gesammelt, sobald du sie synchronisiert hast.</p>
                    </div>
                </div>
                {% if series_sections %}
                    {% for section in series_sections %}
                    <section class="carousel">
                        <div class="section-header">
                            <h3>{{ section.title }}</h3>
                            <span class="section-hint">Serien√ºbersicht</span>
                        </div>
                        {% if section["items"] %}
                        <div class="carousel-track">
                            {% for show in section["items"] %}
                            {% set poster_url = show.poster_path and "https://image.tmdb.org/t/p/w500" + show.poster_path or url_for('static', filename='images/poster-placeholder.svg') %}
                            {% set backdrop_url = show.backdrop_path and "https://image.tmdb.org/t/p/w780" + show.backdrop_path or '' %}
                            <article class="card" role="button" tabindex="0"
                                     data-movie-id="{{ show.id }}"
                                     data-title="{{ show.title }}"
                                     data-overview="{{ show.overview|default('')|e }}"
                                     data-backdrop="{{ backdrop_url }}"
                                     data-poster="{{ poster_url }}"
                                     data-release="{{ show.release_date or '' }}">
                                <div class="card-poster" style="background-image: url('{{ poster_url }}');"></div>
                                <div class="card-overlay">
                                    <h4>{{ show.title }}</h4>
                                    <p>{{ show.release_date or 'Unbekannt' }}</p>
                                    <span class="rating">‚≠ê {{ (show.rating or 0)|round(1) }}</span>
                                </div>
                            </article>
                            {% endfor %}
                        </div>
                        {% else %}
                        <p class="empty">Diese Kategorie enth√§lt noch keine Serien.</p>
                        {% endif %}
                    </section>
                    {% endfor %}
                {% else %}
                    <p class="empty large">Noch keine Serien synchronisiert.</p>
                {% endif %}
            </section>

            <section class="panel" data-section="scraper">
                <div class="panel-header">
                    <div>
                        <h2>Scraper</h2>
                        <p class="panel-subtitle">Verwalte Links, die √ºber die Scraper gesammelt wurden.</p>
                    </div>
                </div>
                <div class="scraper-grid">
                    {% for link in scraped %}
                    <div class="scraper-card" data-movie-id="{{ link.movie.id }}" role="button" tabindex="0">
                        <div>
                            <h4>{{ link.movie.title }}</h4>
                            <p>{{ link.source_name }} ¬∑ {{ link.mirror_info or 'Mirror' }}</p>
                        </div>
                        <button type="button" class="btn btn-ghost view-detail" data-movie-id="{{ link.movie.id }}">Details anzeigen</button>
                    </div>
                    {% else %}
                    <p class="empty large">Noch keine gescrapten Links vorhanden.</p>
                    {% endfor %}
                </div>
            </section>

            <section class="panel" data-section="settings" id="settings">
                <div class="panel-header">
                    <div>
                        <h2>Einstellungen</h2>
                        <p class="panel-subtitle">Verwalte Schl√ºssel und Scraper-Einstellungen.</p>
                    </div>
                </div>
                <form id="settingsForm" class="settings-form">
                    <div class="form-grid">
                        <label class="form-field">
                            <span class="form-label">TMDB API Key</span>
                            <input type="text" name="tmdb_api_key" placeholder="z.B. 123abc" required />
                            <span class="form-hint">Wird f√ºr die Synchronisation von TMDB ben√∂tigt.</span>
                        </label>
                        <label class="form-field">
                            <span class="form-label">Kinox Startseite</span>
                            <input type="number" min="1" name="kinox_start_page" />
                            <span class="form-hint">Erste Seite f√ºr den Scraper.</span>
                        </label>
                        <label class="form-field">
                            <span class="form-label">Kinox Endseite</span>
                            <input type="number" min="1" name="kinox_end_page" />
                            <span class="form-hint">Letzte Seite f√ºr den Scraper.</span>
                        </label>
                    </div>
                    <div class="form-actions">
                        <button type="submit" class="btn btn-primary">Einstellungen speichern</button>
                    </div>
                </form>
                <div class="settings-reset">
                    <div>
                        <h3>Scraper zur√ºcksetzen</h3>
                        <p class="panel-subtitle">L√∂sche alle gescrapten Inhalte und beginne erneut.</p>
                    </div>
                    <button type="button" id="resetScraped" class="btn btn-secondary">Gescrapte Inhalte l√∂schen</button>
                </div>
            </section>
        </main>
    </div>

    <section class="panel detail-panel" data-section="detail">
        <div class="detail-viewport">
            <div class="detail-hero" id="detailHero">
                <div class="detail-hero-media" id="detailBackdrop"></div>
                <div class="detail-hero-gradient"></div>
                <div class="detail-hero-content">
                    <div class="detail-hero-top">
                        <button class="detail-back" type="button" aria-label="Zur√ºck">
                            <span class="detail-back-icon">‚Üê</span>
                            <span>Zur√ºck</span>
                        </button>
                        <div class="detail-hero-meta">
                            <div class="detail-hero-poster">
                                <img
                                    id="detailPoster"
                                    alt="Poster"
                                    data-placeholder="{{ url_for('static', filename='images/poster-placeholder.svg') }}"
                                />
                            </div>
                            <div class="detail-hero-info">
                                <div class="detail-hero-head">
                                    <h2 id="detailTitle"></h2>
                                    <p id="detailTagline" class="detail-tagline"></p>
                                </div>
                                <div class="detail-meta" id="detailMeta"></div>
                                <p id="detailOverview" class="detail-hero-overview"></p>
                                <div class="detail-hero-actions">
                                    <button class="detail-action primary" type="button" id="detailWatch" disabled>
                                        <span class="detail-action-icon">‚ñ∂</span>
                                        <span id="detailWatchLabel">Ansehen</span>
                                    </button>
                                    <button class="detail-action ghost" type="button" id="detailTrailerButton" disabled>
                                        <span class="detail-action-icon">üé¨</span>
                                        <span>Trailer</span>
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="detail-content">
                <div class="detail-columns">
                    <div class="detail-main">
                        <section class="detail-section detail-overview">
                            <h3>√úberblick</h3>
                            <p id="detailOverviewSecondary"></p>
                            <ul id="detailFacts" class="detail-facts"></ul>
                        </section>
                        <section class="detail-section detail-section--cast">
                            <div class="detail-section-head">
                                <h3>Besetzung</h3>
                                <span class="detail-section-subtitle">Die wichtigsten Schauspieler:innen auf einen Blick</span>
                            </div>
                            <ul
                                id="detailCast"
                                class="detail-cast"
                                data-placeholder="{{ url_for('static', filename='images/profile-placeholder.svg') }}"
                            ></ul>
                        </section>
                    </div>
                    <aside class="detail-side">
                        <section class="detail-section">
                            <h3>Streams</h3>
                            <div id="detailStreaming" class="detail-streaming"></div>
                        </section>
                    </aside>
                </div>
                <section class="detail-section detail-all-movies">
                    <div class="detail-section-head">
                        <h3>Alle Filme</h3>
                        <div class="detail-pagination">
                            <button type="button" id="detailAllPrev" class="detail-page-btn" aria-label="Vorherige Seite">
                                ‚Äπ
                            </button>
                            <span id="detailAllPageLabel" class="detail-page-label"></span>
                            <button type="button" id="detailAllNext" class="detail-page-btn" aria-label="N√§chste Seite">
                                ‚Ä∫
                            </button>
                        </div>
                    </div>
                    <div id="detailAllMovies" class="detail-all-grid"></div>
                </section>
            </div>
        </div>
    </section>

    <div class="modal" id="trailerModal" aria-hidden="true">
        <div class="modal-backdrop" data-dismiss="modal"></div>
        <div class="modal-dialog" role="dialog" aria-modal="true" aria-labelledby="trailerModalTitle">
            <button type="button" class="modal-close" aria-label="Schlie√üen">&times;</button>
            <div class="modal-content">
                <h3 id="trailerModalTitle">Trailer</h3>
                <div class="modal-body">
                    <iframe
                        id="trailerModalFrame"
                        src=""
                        title="Trailer"
                        allow="fullscreen; picture-in-picture; encrypted-media"
                        allowfullscreen
                        loading="lazy"
                        referrerpolicy="no-referrer"
                    ></iframe>
                </div>
            </div>
        </div>
    </div>

    <div class="toast" id="toast"></div>
    <script src="{{ url_for('static', filename='js/main.js') }}" defer></script>
</body>
</html>
